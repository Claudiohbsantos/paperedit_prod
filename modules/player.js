import*as utils from"./utils.js";class Player{constructor(){this.filename="",this.skipStriked=!1,this.currentSection=null,this.duration=0,this.yOffset=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--headerHeight")),this.yTotal=document.getElementById("waveform").offsetWidth,this.cursorDisplayHeight=document.getElementById("cursor-display").offsetHeight}init(){document.getElementById("hidden-audioinput").addEventListener("change",e=>{this.loadNewAudioFile(e)})}startPlayer(){this.hasOwnProperty("wavesurfer")||(this.startWavesurfer(),this.adaptInterfaces(),this.on("ready",()=>{document.dispatchEvent(new CustomEvent("loadaudio-end")),this.duration=this.getDuration(),this.setMediaMetadata(),this.initMediaSession()}),document.dispatchEvent(new CustomEvent("playerStarted")))}startWavesurfer(){let e=WaveSurfer.create({progressColor:"black",container:"#waveform",barWidth:.8,barMinHeight:.5,barGap:2,normalize:!0,responsive:!0,hideScrollbar:!0,loopSelection:!1,fillParent:!0,height:150,plugins:[WaveSurfer.regions.create({}),WaveSurfer.cursor.create({showTime:!1,opacity:.3})]});this.wavesurfer=e}updateSkipLength(e){this.hasOwnProperty("wavesurfer")&&(this.wavesurfer.params.skipLength=e)}adaptInterfaces(){this.cancelAjax=(...e)=>this.wavesurfer.cancelAjax(...e),this.destroy=(...e)=>this.wavesurfer.destroy(...e),this.empty=(...e)=>this.wavesurfer.empty(...e),this.getActivePlugins=(...e)=>this.wavesurfer.getActivePlugins(...e),this.getBackgroundColor=(...e)=>this.wavesurfer.getBackgroundColor(...e),this.getCurrentTime=(...e)=>this.wavesurfer.getCurrentTime(...e),this.getCursorColor=(...e)=>this.wavesurfer.getCursorColor(...e),this.getDuration=(...e)=>this.wavesurfer.getDuration(...e),this.getPlaybackRate=(...e)=>this.wavesurfer.getPlaybackRate(...e),this.getProgressColor=(...e)=>this.wavesurfer.getProgressColor(...e),this.getVolume=(...e)=>this.wavesurfer.getVolume(...e),this.getMute=(...e)=>this.wavesurfer.getMute(...e),this.getFilters=(...e)=>this.wavesurfer.getFilters(...e),this.getWaveColor=(...e)=>this.wavesurfer.getWaveColor(...e),this.exportPCM=(...e)=>this.wavesurfer.exportPCM(...e),this.exportImage=(...e)=>this.wavesurfer.exportImage(...e),this.isPlaying=(...e)=>this.wavesurfer.isPlaying(...e),this.load=(...e)=>this.wavesurfer.load(...e),this.loadBlob=(...e)=>this.wavesurfer.loadBlob(...e),this.on=(...e)=>this.wavesurfer.on(...e),this.un=(...e)=>this.wavesurfer.un(...e),this.unAll=(...e)=>this.wavesurfer.unAll(...e),this.pause=(...e)=>this.wavesurfer.pause(...e),this.play=(...e)=>this.wavesurfer.play(...e),this.playPause=(...e)=>this.wavesurfer.playPause(...e),this.seekAndCenter=(...e)=>this.wavesurfer.seekAndCenter(...e),this.seekTo=(...e)=>this.wavesurfer.seekTo(...e),this.setBackgroundColor=(...e)=>this.wavesurfer.setBackgroundColor(...e),this.setCursorColor=(...e)=>this.wavesurfer.setCursorColor(...e),this.setHeight=(...e)=>this.wavesurfer.setHeight(...e),this.setFilter=(...e)=>this.wavesurfer.setFilter(...e),this.setPlaybackRate=(...e)=>this.wavesurfer.setPlaybackRate(...e),this.setPlayEnd=(...e)=>this.wavesurfer.setPlayEnd(...e),this.setVolume=(...e)=>this.wavesurfer.setVolume(...e),this.setMute=(...e)=>this.wavesurfer.setMute(...e),this.setProgressColor=(...e)=>this.wavesurfer.setProgressColor(...e),this.setWaveColor=(...e)=>this.wavesurfer.setWaveColor(...e),this.skip=(...e)=>this.wavesurfer.skip(...e),this.skipBackward=(...e)=>this.wavesurfer.skipBackward(...e),this.skipForward=(...e)=>this.wavesurfer.skipForward(...e),this.setSinkId=(...e)=>this.wavesurfer.setSinkId(...e),this.stop=(...e)=>this.wavesurfer.stop(...e),this.toggleMute=(...e)=>this.wavesurfer.toggleMute(...e),this.toggleInteraction=(...e)=>this.wavesurfer.toggleInteraction(...e),this.toggleScroll=(...e)=>this.wavesurfer.toggleScroll(...e),this.zoom=(...e)=>this.wavesurfer.zoom(...e),this.addRegion=(...e)=>this.wavesurfer.addRegion(...e),this.clearRegions=(...e)=>this.wavesurfer.clearRegions(...e),this.enableDragSelection=(...e)=>this.wavesurfer.enableDragSelection(...e),this.backend=this.wavesurfer.backend}addCustomRegion(e){if(!this.hasOwnProperty("wavesurfer"))return null;let t={start:e.start,loop:e.loop||!1,drag:e.drag||!1,resize:e.resize||!1,color:e.color||"rgba(0,0,255,0.4)",attributes:{}};return e.end&&(t.end=e.end),e.type&&(t.attributes.type=e.type),this.addRegion(t)}skipStrikedSegments(e,t){for(let s of t)if(e>=s[0]&&e<=s[1]){this.seekTo(this.progressFromSec(s[1]));break}}seekToSec(e){this.hasOwnProperty("wavesurfer")&&this.seekTo(this.progressFromSec(e))}getTimeAtYPos(e){return Math.floor(this.duration*e/this.yTotal)}getYPos(e){return this.yTotal*e/this.duration}progressFromSec(e){let t=e/this.duration;return t>1?1:t}unloadAudio(){if(!this.hasOwnProperty("wavesurfer"))return null;this.filename="",this.empty(),document.dispatchEvent(new CustomEvent("unloadaudio"))}importAudio(){document.getElementById("hidden-audioinput").click()}loadNewAudioFile(e){let t=e.target.files[0];this.isValidAudioFile(t)?this.loadAudio(t):utils.showWarning(t.name+" is not a valid sound file. Please pick a .wav, .mp3, .m4a or .aac file for playback.")}loadAudio(e){this.startPlayer(),this.clearRegions(),this.loadBlob(e),document.dispatchEvent(new CustomEvent("loadaudio-start")),this.filename=e.name}isValidAudioFile(e){return/\.wav|.mp3|.aac|.ogg|.flac|.m4a$/i.test(e.name)}initMediaSession(){if("mediaSession"in navigator){navigator.mediaSession.setActionHandler("play",t=>{this.playPause(),e.play()}),navigator.mediaSession.setActionHandler("stop",t=>{this.playPause(),e.pause()}),navigator.mediaSession.setActionHandler("pause",t=>{this.playPause(),e.pause()}),navigator.mediaSession.setActionHandler("seekbackward",()=>{this.skipBackward()}),navigator.mediaSession.setActionHandler("seekforward",()=>{this.skipForward()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{this.skipBackward()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{this.skipForward()}),this.on("play",(function(){navigator.mediaSession.playbackState="playing"})),this.on("pause",(function(){navigator.mediaSession.playbackState="paused"})),navigator.mediaSession.playbackState="paused";let e=document.querySelector("audio");e.play().then(()=>{e.pause(),this.updateMediaSession()}).catch(e=>console.log(e))}}updateMediaSession(){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata(this.mediaMetadata))}setMediaMetadata(){this.mediaMetadata={title:this.filename,artist:"Paperedit project",album:"Paperedit",artwork:[{src:"/assets/favicons/android-chrome-512x512.png"}]}}}const playerInstance=new Player;playerInstance.init();export default playerInstance;