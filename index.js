import player from"./modules/player.js";import editor from"./modules/quill.js";import paperedit from"./modules/transcript.js";import{keybindings}from"./modules/userSettings.js";import actions from"./modules/userActions.js";import{init as initHotkeys}from"./modules/hotkeys.js";import{parseTimestamps}from"./modules/parser.js";editor.quill.on("text-change",parseTimestamps),paperedit.queue.start(),loadSaved(),initHotkeys(keybindings,actions),registerUIEvents(),initTooltips(),startAutosave(5e3);import initEditorWindow from"./components/editor.js";import leftSidebar from"./components/leftSidebar.js";import toolbar from"./components/toolbar.js";function registerUIEvents(){window.addEventListener("dragover",dragAndDropImport),document.body.addEventListener("drop",dragAndDropImport)}function startAutosave(t){window.setInterval(()=>paperedit.saveLocalPapercut(),t)}function loadSaved(){if(localStorage.getItem("papercut")){let t=JSON.parse(localStorage.getItem("papercut"));paperedit.loadPapercut(t)}}function dragAndDropImport(t){if(t.preventDefault(),"drop"===t.type&&t.dataTransfer.files&&t.dataTransfer.files.length>0){let e=!1,o=!1;for(let i of t.dataTransfer.files)!o&&player.isValidAudioFile(i)&&(o=!0,player.loadAudio(i)),!e&&/\.ppcut$/i.test(i.name)&&(e=!0,paperedit.loadPapercutFile(i))}}function initTooltips(){let t=document.getElementsByClassName("has-tooltip"),e=document.getElementById("dyntooltip");for(let o of t)(o.dataset.action||o.dataset.tooltip)&&(o.addEventListener("mouseenter",t=>{if(o.dataset.action)var i=`${actions[o.dataset.action].label} ${keybindings[o.dataset.action]?"["+keybindings[o.dataset.action]+"]":""}`;else i=o.dataset.tooltip||"";e.textContent=i,t.clientY>window.innerHeight/2?(e.style.bottom=window.innerHeight-t.clientY+20+"px",e.style.top=null):(e.style.bottom=null,e.style.top=t.clientY+20+"px"),t.clientX>window.innerWidth/2?(e.style.left=null,e.style.right=window.innerWidth-t.clientX+20+"px"):(e.style.right=null,e.style.left=t.clientX+20+"px"),e.style.opacity=1,window.setTimeout(()=>e.style.transitionDelay="0s",600)}),o.addEventListener("mouseleave",()=>{e.textContent="",e.style.opacity=0,e.style.left="-100px",e.style.top="-100px",e.style.right="101vw",e.style.bottom="101vh",window.setTimeout(()=>e.style.transitionDelay="1s",500)}))}function tempTester(){}initEditorWindow(),leftSidebar.init(),toolbar.init(),Mousetrap.bind("alt+shift+d",tempTester);