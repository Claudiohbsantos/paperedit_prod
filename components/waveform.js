"use strict";import*as utils from"../modules/utils.js";import player from"../modules/player.js";import paperedit from"../modules/transcript.js";import editor from"../modules/quill.js";import actions from"../modules/userActions.js";export default{element:document.getElementById("player-container"),playerEventsBound:!1,init(){this.attachListeners()},show(){this.playerEventsBound||(player.on("audioprocess",e=>movePlayhead(e)),player.on("seek",e=>movePlayhead(e*player.duration)),player.on("region-click",(e,t)=>{t.ctrlKey&&actions.selectSectionInEditor.handler(e)}),player.on("region-created",removeRegionTitle)),this.element.style.opacity=1,this.element.style.visibility="visible"},hide(){this.element.style.opacity=0,this.element.style.visibility="hidden"},attachListeners(){document.getElementById("waveform").addEventListener("mouseenter",showCursorDisplay),document.getElementById("waveform").addEventListener("mouseleave",hideCursorDisplay),document.getElementById("waveform").addEventListener("mousemove",moveCursorDisplay),document.addEventListener("audioload-end",updateEndTimeDisplay),document.addEventListener("audioload-end",()=>{movePlayhead(player.getCurrentTime())}),document.getElementById("editor-container").addEventListener("scroll",showScrollIndicator),editor.quill.on("text-change",showScrollIndicator),editor.quill.on("selection-change",(e,t)=>highlightSelectedSection(e))}};function movePlayhead(e){let t=document.getElementById("playhead-display"),i=document.getElementById("playhead"),o=player.getYPos(e);t.textContent=utils.tsFromSeconds(Math.floor(e)),t.style.top=o-player.cursorDisplayHeight/2-2+"px",i.style.top=o+"px"}function updateEndTimeDisplay(){document.getElementById("endtime-display").textContent=utils.tsFromSeconds(player.getDuration())}function showCursorDisplay(){document.getElementById("cursor-display").style.visibility="visible"}function hideCursorDisplay(){document.getElementById("cursor-display").style.visibility="hidden"}function moveCursorDisplay(e){let t=e.pageY-player.yOffset,i=document.getElementById("cursor-display");i.style.top=t-player.cursorDisplayHeight/2-2+"px",i.textContent=utils.tsFromSeconds(player.getTimeAtYPos(t))}function showScrollIndicator(e){if(0==player.duration)return;let t,i=e&&e.target?e.target:document.getElementById("editor-container"),o=i.scrollTop,n=i.getBoundingClientRect().height,l=document.getElementById("title-input").getBoundingClientRect().height;if(t=o<l?paperedit.getSectionsInCoordinateRange(0,n-o):paperedit.getSectionsInCoordinateRange(o-l,n),t.length>1){let e=player.getYPos(t[0].time),i=t.pop().nextSection(),o=i?player.getYPos(i.time):player.getYPos(player.duration),n=document.getElementById("scroll-indicator");n.style.height=o-e+"px",n.style.top=e+"px"}else{document.getElementById("scroll-indicator").style.height="0px"}}function removeRegionTitle(e){getRegionElement(e.id).removeAttribute("title")}function getRegionElement(e){let t=document.getElementsByClassName("wavesurfer-region");for(let i of t)if(i.dataset.id==e)return i}function highlightSelectedSection(e){if(0==player.duration)return;if(!e||!e.index){return void(document.getElementById("edit-indicator").style.height="0px")}let t=paperedit.getSectionAtIndex(e.index);if(t){let e=player.getYPos(t.time),i=player.getYPos(t.endTime)-e,o=document.getElementById("edit-indicator");o.style.height=i+"px",o.style.top=e+"px"}else{document.getElementById("edit-indicator").style.height="0px"}}